name: 'setup-rust'
description: 'install Rust toolchain, using rustup'
# Adapted from https://github.com/actions-rs/toolchain/issues/216#issuecomment-1291613319

inputs:
  toolchain:
    required: false
    description: "Rust toolchain, e.g. 'stable' or 'nightly'"
    default: stable
  components:
    required: false
    description: Comma-separated string of additional components to install e.g. "clippy, rustfmt"


runs:
  using: "composite"
  steps:
    - name: "Install Rust toolchain"
      run: |
        rustup toolchain install ${{ inputs.toolchain }} --profile minimal --no-self-update
        rustup default ${{ inputs.toolchain }}
      shell: bash

    - name: "Set environment variables used by toolchain"
      run: |
        echo CARGO_TERM_COLOR=always >> $GITHUB_ENV
        echo CARGO_INCREMENTAL=0 >> $GITHUB_ENV
        echo RUST_BACKTRACE=1 >> $GITHUB_ENV

        rustc --version --verbose
      shell: bash

    - name: "Install Rust components"
      if: ${{ inputs.components != '' }}
      run: |
        components=$(for c in ${components//,/ }; do echo -n ' ' $c; done)
        rustup component add $components
      env:
        components: ${{ inputs.components }}
      shell: bash
